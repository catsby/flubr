// Generated by CoffeeScript 1.7.1
var app, bodyParser, cookieParser, express, home, images, logger, mongoose, nib, path, stylus;

express = require('express');

mongoose = require('mongoose');

stylus = require('stylus');

nib = require('nib');

images = require('./controller/images');

home = require('./routes/index');

path = require('path');

logger = require('morgan');

cookieParser = require('cookie-parser');

bodyParser = require('body-parser');

app = express();

app.set('port', process.env.PORT || 3000);

app.set('views', path.join(__dirname, '..', 'views'));

app.set('view engine', 'jade');

app.set('storage-uri', process.env.MONGOHQ_URL || 'mongodb://localhost/images');

app.use(stylus.middleware({
  src: path.join(__dirname, '..', 'views'),
  dest: path.join(__dirname, '..', 'public'),
  debug: true,
  compile: function(str, _path) {
    return stylus(str).set('filename', _path).set('compress', true).use(nib())["import"]('nib');
  }
}));

app.use(express["static"](path.join(__dirname, '..', 'public')));

app.use(logger('dev'));

app.use(bodyParser.json());

app.use(bodyParser.urlencoded());

app.use(cookieParser());

app.use('/', home);

mongoose.connect(app.get('storage-uri'), {
  db: {
    safe: true
  }
}, function(err) {
  if (err != null) {
    console.log('Mongoose - connection error: ' + err);
  }
  return console.log('Mongoose - connection OK');
});

require('./model/image');

app.post('/images', images.create);

app.get('/images', images.retrieve);

app.get('/images/:type', images.retrieve);

app.listen(app.get('port'), function() {
  return console.log("Listening on port " + (app.get('port')));
});

//# sourceMappingURL=app.map
